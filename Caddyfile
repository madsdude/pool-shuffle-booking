{
  email admin@poolhall.dk
}

(poolhall_common) {
  encode gzip
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer-when-downgrade"
    Permissions-Policy "interest-cohort=()"
    Content-Security-Policy "upgrade-insecure-requests"
  }
}

# WWW -> apex
www.poolhall.dk {
  import poolhall_common
  redir https://poolhall.dk{uri} 308
}

poolhall.dk {
  import poolhall_common

  # API først, så det ikke rammer catch-all
  @api path /api* /docs* /openapi.json
  reverse_proxy @api booking:8000

  # Statics (billeder, js, css)
  handle_path /static* {
    root * /srv/static
    file_server
  }

  # Staff-side (/staff) -> index.html i /srv/static
  handle_path /staff* {
    root * /srv/static
    rewrite * /index.html
    file_server
  }

  # Forside (catch-all) -> public-booking.html i /srv/static
  handle {
    root * /srv/static
    rewrite * /public-booking.html
    file_server
  }
}
