{
  email admin@poolhall.dk
}

(poolhall_common) {
  encode gzip
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer-when-downgrade"
    Permissions-Policy "interest-cohort=()"
    Content-Security-Policy "upgrade-insecure-requests"
  }
}

# WWW -> apex
poolhall.dk {
  import poolhall_common

  # 1) API -> FastAPI (container: booking:8000)
  @api path /api/* /openapi.json /docs
  handle @api {
    reverse_proxy booking:8000
  }

  # 2) Statik (CSS/JS/billeder)
  handle_path /static/* {
    root * /srv/static
    file_server
  }

  # 3) Staff-app
  handle_path /staff* {
    root * /srv/static
    rewrite * /index.html
    file_server
  }

  # 4) Forside/catch-all -> public-booking
  handle {
    root * /srv/static
    rewrite * /public-booking.html
    file_server
  }
}

