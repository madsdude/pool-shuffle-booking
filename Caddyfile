{
  email admin@poolhall.dk
}

(poolhall_common) {
  encode gzip
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer-when-downgrade"
    Permissions-Policy "interest-cohort=()"
    Content-Security-Policy "upgrade-insecure-requests"
  }
}

# WWW -> apex
poolhall.dk {
  import poolhall_common

  # API -> FastAPI (vigtigt: brug 'handle' + matcher, ikke handle_path)
  @api path /api/* /openapi.json /docs
  handle @api {
    reverse_proxy booking:8000
  }

  # Statik
  handle_path /static/* {
    root * /srv/static
    file_server
  }

  # Staff single-page app
  handle_path /staff* {
    root * /srv/static
    rewrite * /index.html
    file_server
  }

  # Catch-all -> offentlig booking
  handle {
    root * /srv/static
    rewrite * /public-booking.html
    file_server
  }
}


